<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>FLIP COFFEE</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" th:href="@{/css/surveyStats.css}">
</head>
<body>
<header class="header">
  <nav class ="nav">
    <div class="container">
      <a href="/home" class ="left">FLIP COFFEE</a>
      <div class ="center">
        <a href="/about" class ="menu">ABOUT</a>
        <a href="/menu" class ="menu">MENU</a>
        <a href="/store" class ="menu">STORE</a>
        <a href="/community" class ="menu">COMMUNITY</a>
        <a th:href="@{/menu/manage}" class ="menu">MANAGER</a> <!--관리자 로그인시 나타나는 메뉴-->

      </div>
      <div class ="right">
        <a href="" class ="login">로그인</a>
        <a href="" class ="mypage">마이페이지</a>
      </div>
      <div>
        <!--다음 등급 까지 ???점 남았습니다 표시-->
      </div>
    </div>
  </nav>
</header>
<main class="main">
  <div class="sidebar">
    <ul>
      <li><a href="#" class="big">ABOUT US</a></li>
      <li><a href="#" class="small">FLIP COFFEE IS</a></li>
      <li><a href="#" class="small">BI</a></li>
      <li><a href="#" class="small">오시는 길</a></li>
      <li><a href="#" class="big">Menu</a></li>
      <li><a href="#" class="small">NEW</a></li>
      <li><a href="#" class="small">COFFEE</a></li>
      <li><a href="#" class="small">CLOD BREW</a></li>
      <li><a href="#" class="small">BEVERAGE</a></li>
      <li><a href="#" class="small">FRAPRE</a></li>
      <li><a href="#" class="small">ADE & MOJITO</a></li>
      <li><a href="#" class="small">TEA & JUICE</a></li>
      <li><a href="#" class="small">DESSSERT</a></li>
      <li><a href="#" class="big">STORE</a></li>
      <li><a href="#" class="small">확정예약</a></li>
      <li><a href="#" class="small">유동예약</a></li>
      <li><a href="#" class="small">신청 조회</a></li>
      <li><a href="#" class="big">COMMUNITY</a></li>
      <li><a href="#" class="small">공지 사항</a></li>
      <li><a href="#" class="small">자주하는 질문</a></li>
      <li><a href="#" class="small">고객 상담</a></li>
      <li><a href="#" class="small">설문 조사</a></li>
      <!-- 관리자가 로그인할 경우 생기는 부분-->
      <li><a href="#" class="big">관리자</a></li>
      <li><a href="#" class="small">공간 관리</a></li>
      <li><a href="#" class="small">정책 관리</a></li>
      <li><a href="#" class="small">경고 관리</a></li>
      <li><a href="#" class="small">업체 관리</a></li>
      <li><a href="#" class="small">성수기 지정</a></li>
      <li><a href="#" class="small">통계 관리</a></li>
      <li><a href="#" class="small">이의 신청 관리</a></li>
      <li><a href="#" class="small">설문 관리</a></li>
    </ul>
  </div>
<!--여기서 부터 코드 추가-->
  <div class="chart-container">
    <div class="chart-h1"> <!--스타일 부분 나중에 수정.-->
      <h1>설문조사 통계 차트</h1>
      <div class="chart-style">
        <form th:action="@{surveys}" method="post">
          <canvas id="myChart"></canvas>
        </form>
      </div>
    </div>
  </div>

  <script>
      fetch('/surveys/' + surveyId)
          .then(response => response.json())
          .then(survey => {
              // 선택된 항목들만 필터링
              const selectedItems = survey.items.filter(item => item.isSelected);

              // 모든 항목이 선택된 횟수의 합 계산
              const totalCounts = selectedItems.reduce((total, item) => total + item.count, 0);

              const data = {
                  labels: selectedItems.map(item => item.name), // 선택된 설문조사 항목 이름
                  datasets: [{
                      data: selectedItems.map(item => (item.count / totalCounts) * 100), // 각 항목이 선택된 횟수의 백분율
                      backgroundColor: selectedItems.map((item, index) => `hsl(${index * 25}, 100%, 50%)`)
                  }]
              };

              const options = {
                  responsive: true,
                  maintainAspectRatio: false
              };

              const ctx = document.getElementById('myChart').getContext('2d');
              const myChart = new Chart(ctx, {
                  type: 'pie',
                  data: data,
                  options: options
              });
          });
  </script>
</main>
<footer>
  <div class="footer-container">
    <div class="footer-group">
      <div class="footer-section">
        <div class='company-info'>
          <h3>FLIP COFFEE</h3>
          <p >(주)DB컴퍼니 | 대표자 : DB8조</p>
          <p>부산광역시 해운대구 달맞이길 35</p>
          <p>사업자등록번호 : 509-82-01524</p>
          <p>대표번호 : 1811-5821 | FAX : 02-432-1421</p>
          <P>________________________________________</P>
          <P>2023 플립커피 All rights reserved.</P>
        </div>
        <div class="footer-links">
          <p href="#">이용약관</p>
          <p href="#">개인정보처리방침</p>
        </div>
      </div>
    </div>
  </div>
</footer>
</body>
</html>